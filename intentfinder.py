#Monica Kumaran - REU Summer 2016
#NOTES FOR USING MY CODES
# 1) program finds any searchword u specify in the manifest file + saves in csv file of 1's and 0's
# 2) "INTENTS.txt" can be replaced with any file with list of searchwords each on new line
# 3) obviously remember to change file paths where neeeded 
# 4) PLS thank me in your acknowledgements if you find this code really helpful 

import os  
import subprocess
import xml.etree.ElementTree as ET
import csv

istring = ["App Name"]
f = open("INTENTS.txt")
p = f.readlines()
idict = {}
i = 1
for entry in p: 
	entry = entry.strip()
	entry = entry.strip('\"')
	idict[entry] = i
	istring.append(entry + " ")
	i+=1
istring.append("IS_MALICIOUS")

path = '/home/seed/Desktop/good-apps/man'
files = os.listdir(path)

with open('good_intents.csv', 'w') as myfile:
	wr = csv.writer(myfile, quoting=csv.QUOTE_ALL)
	wr.writerow(istring)

	for f in files:	
	#THIS IS FOR EVERY APP - MAKING IT AN ARRAY OF ALL ZEROES FOR EACH ATTRIBUTE
		res = [0] * (len(idict) + 1)
		if 'b' in f and os.path.isfile('man/'+ f + '/AndroidManifest.xml'):
			res[0] = f
			tree = ET.parse('man/'+ f + '/AndroidManifest.xml')
			root = tree.getroot()
			string = str(ET.tostring(root[len(root)-1]))
			for k in idict:
				if k in string:
					res[idict[k]] = 1			

			#uses dictionary of permission-number for index save 1's in app array

			#IF GOOD APP NEXT LINE SHOULD APPEND 0 IF BAD APP 1
			res.append(0)
			wr.writerow(res)
